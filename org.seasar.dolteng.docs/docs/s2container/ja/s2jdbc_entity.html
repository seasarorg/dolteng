<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">










<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
<meta http-equiv="Content-Language" content="ja" /> 
<meta http-equiv="Content-Style-Type" content="text/css" /> 
<title>Seasar2 - S2JDBC - エンティティ</title>
<link rel="stylesheet" type="text/css" href="http://www.seasar.org/theme/main.css" media="screen,projection" />
<link rel="stylesheet" type="text/css" href="http://www.seasar.org/theme/print.css" media="print" />
<link href="./css/maven-base.css" type="text/css" rel="stylesheet" media="screen" />
<link href="./css/maven-theme.css" type="text/css" rel="stylesheet" media="screen" />
</head>

<body>

<div id="wrapper">

<div id="header">

<div class="line"><span class="hide">spacer</span></div>

<div id="logo"><h1 id="h01" class="hide">The Seasar Foundation Project Site</h1><img src="http://www.seasar.org/images/seasar_logo_blue.gif" alt="The Seasar Foundation" width="390" height="180" /></div>

<div id="tool">

<h2><a href="http://search.seasar.org/">Site Search</a></h2>

<form id="search" action="http://search.seasar.org/">
<div>
	<input id="search_phrase" type="text" name="phrase" size="20" />
	<input type="hidden" name="perpage" value="30" />
	<input type="hidden" name="enc" value="UTF-8" />
	<input id="search_go" type="submit" value="Search" />
</div>
</form>

<h2>Seasar Banner</h2>

<p><a href="http://www.seasar.org/images/seasar_banner.gif"><img src="http://www.seasar.org/images/seasar_banner.gif" alt="Seasar Banner" title="Seasar Banner" width="146" height="33" /></a></p>

</div>

<div id="navi">
<p><a href="../en/">English</a> | <a href="../ja/">Japanese</a></p>
</div>

</div><!-- header -->

<div id="contents_left">
           
  

  
    
  
  
                   <h2>About</h2>
        <ul>
              
    <li class="none">
              <a href="index.html">ホーム</a>
        </li>
              
    <li class="none">
              <a href="license.html">ライセンス</a>
        </li>
              
    <li class="none">
              <a href="downloads.html">ダウンロード</a>
        </li>
              
    <li class="none">
              <a href="http://www.seasar.org/wiki/index.php?ChangeLog%2FSeasar">ChangeLog</a>
        </li>
              
    <li class="none">
              <a href="http://www.seasar.org/wiki/index.php?SeasarUpdateOperationLog">移行ガイド</a>
        </li>
          </ul>
          <h2>ドキュメント</h2>
        <ul>
              
    <li class="none">
              <a href="documents.html">一覧</a>
        </li>
              
    <li class="none">
              <a href="setup.html">セットアップ</a>
        </li>
              
    <li class="none">
              <a href="DIContainer.html">DIContainer</a>
        </li>
              
    <li class="none">
              <a href="aop.html">AOP</a>
        </li>
              
                
              
      
            
      
            
      
            
            
            
      
            
      
            
      
            
      
                  
      
              
            <li class="expanded">
              <a href="s2jdbc.html">S2JDBC</a>
                <ul>
                  
    <li class="none">
              <a href="s2jdbc_abstract.html">S2JDBCとは</a>
        </li>
                  
    <li class="none">
              <a href="s2jdbc_tutorial.html">チュートリアル</a>
        </li>
                  
    <li class="none">
              <a href="s2jdbc_setup.html">セットアップ</a>
        </li>
                  
    <li class="none">
              <strong>エンティティ</strong>
        </li>
                  
                
              
      
            
      
            
      
              
        <li class="collapsed">
              <a href="s2jdbc_manager.html">JdbcManager</a>
              </li>
                  
    <li class="none">
              <a href="s2jdbc_other.html">その他の機能</a>
        </li>
              </ul>
        </li>
              
    <li class="none">
              <a href="http://www.seasar.org/wiki/index.php?FAQ%2FS2Container">FAQ (全般)</a>
        </li>
              
    <li class="none">
              <a href="http://www.seasar.org/wiki/index.php?FAQ%2FS2AOP">FAQ (AOP)</a>
        </li>
          </ul>
          <h2>Javadoc</h2>
        <ul>
              
    <li class="none">
              <a href="../s2-framework/ja/apidocs/index.html">S2-Framework</a>
        </li>
              
    <li class="none">
              <a href="../s2-extension/ja/apidocs/index.html">S2-Extension</a>
        </li>
              
    <li class="none">
              <a href="../s2-tiger/ja/apidocs/index.html">S2-Tiger</a>
        </li>
          </ul>
          <h2>モジュール</h2>
        <ul>
              
    <li class="none">
              <a href="index.html">Seasar2</a>
        </li>
              
    <li class="none">
              <a href="../s2-framework/ja/index.html">S2-Framework</a>
        </li>
              
    <li class="none">
              <a href="../s2-extension/ja/index.html">S2-Extension</a>
        </li>
              
    <li class="none">
              <a href="../s2-tiger/ja/index.html">S2-Tiger</a>
        </li>
          </ul>
          <h2>プロジェクト文書</h2>
        <ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-info.html">プロジェクト情報</a>
              </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy" name="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png" />
          </a>
                       
  

  
    
  
  
  </div><!-- contents_left -->

<div id="contents_center">

<div id="article">
<div class="section"><h2><a name="エンティティ"></a>
エンティティ</h2>
<p></p>
<ul><li><a href="#概要">概要</a>
</li>
<li><a href="#エンティティ定義">エンティティ定義</a>
<ul><li><a href="#テーブル定義">テーブル定義</a>
</li>
<li><a href="#継承">継承</a>
</li>
</ul>
</li>
<li><a href="#プロパティ定義">プロパティ定義</a>
<ul><li><a href="#永続プロパティの型">永続プロパティの型</a>
</li>
<li><a href="#カラム定義">カラム定義</a>
</li>
<li><a href="#識別子定義">識別子定義</a>
</li>
<li><a href="#バージョン定義">バージョン定義</a>
</li>
<li><a href="#時制定義">時制定義</a>
</li>
<li><a href="#ラージオブジェクト定義">ラージオブジェクト定義</a>
</li>
<li><a href="#永続化対象外定義">永続化対象外定義</a>
</li>
</ul>
</li>
<li><a href="#関連定義">関連定義</a>
<ul><li><a href="#多対一関連定義">多対一関連定義</a>
</li>
<li><a href="#一対多関連定義">一対多関連定義</a>
</li>
<li><a href="#一対一関連定義">一対一関連定義</a>
</li>
<li><a href="#結合カラム定義">結合カラム定義</a>
</li>
</ul>
</li>
</ul>
</div>
<div class="section"><h2><a name="概要"></a>
概要</h2>
<p>
				エンティティの定義の仕方を説明します。ここでいっているエンティティとは、
				データベースに永続化されるものだと考えてください。
			</p>
<div style="background-color: red; font-weight: bold; font-size: larger;"><p>注意点</p>
</div><p>
				エンティティ用のアノテーションは、JPAのものをそのまま利用していますが、
				すべてのアノテーションや属性をサポートしているわけではありません。
				ここに取り上げられているもののみサポートされているとお考えください。
			</p>
</div>
<div class="section"><h2><a name="エンティティ定義"></a>
エンティティ定義</h2>
<p>
				エンティティにするためには、
				<code>@Entity</code>
				を必ず指定する必要があります。
			</p>
<div class="source"><pre>@Entity
public class Employee {
    ...
}
</pre>
</div>
<p>
				name属性でエンティティ名を指定することができます。 次の例では、Empというエンティティ名を指定しています。
			</p>
<div class="source"><pre>@Entity(name = &quot;Emp&quot;)
public class Employee {
    ...
}</pre>
</div>
<p>
				name属性を指定しなかった場合、エンティティのクラス名からパッケージ名を除いた部分が、
				デフォルトのエンティティ名になります。例えば、クラス名が
				<code>examples.entity.Employee</code>
				の場合、デフォルトのエンティティ名は、
				<code>Employee</code>
				になります。
			</p>
<div class="section"><h3><a name="テーブル定義"></a>
テーブル定義</h3>
<p>
					テーブル情報を指定するには、
					<code>@Table</code>
					を使います。
				</p>
<p>
					name属性でテーブル名を指定することができます。
					指定しなかった場合、テーブル名はエンティティ名と同じになります。エンティティ名が、
					<code>AaaBbb</code>
					のようなキャメル記法の場合、テーブル名は、
					<code>AAA_BBB</code>
					のように'_'区切りだとみなされます。
				</p>
<p>
					このルールは、convention.diconで指定されている
					<code>
						org.seasar.framework.convention.impl.PersistenceNamingConventionImpl
					</code>
					のfromEntityNameToTableName()の実装を変えることで、カスタマイズすることができます。
				</p>
<p>次の例では、EMPというテーブル名を指定しています。</p>
<div class="source"><pre>@Entity
@Table(name = &quot;EMP&quot;)
public class Employee {
    ...
}</pre>
</div>
<p>
					schema属性でスキーマを指定することができます。
					指定した場合、自動生成されるSQLのテーブル名がスキーマ.テーブル名になります。
				</p>
<p>
					catalog属性でカタログを指定することができます。
					指定した場合、自動生成されるSQLのテーブル名がカタログ.テーブル名になります。
					catalog属性とschema属性の両方を指定した場合、自動生成されるSQLのテーブル名はカタログ.スキーマ.テーブル名になります。
				</p>
</div>
<div class="section"><h3><a name="継承"></a>
継承</h3>
<p>
					エンティティは
					<code>@MappedSuperclass</code>
					が指定されたクラスを継承できます。
				</p>
<div class="source"><pre>@MappedSuperclass
public abstract class AbstractEmployee {
    ...
}</pre>
</div>
<div class="source"><pre>@Entity
public class Employee extends AbstractEmployee {
    ...
}</pre>
</div>
<p><code>@MappedSuperclass</code>
					には、エンティティと同じように永続プロパティを定義できます。
					定義された永続プロパティは、サブクラスの永続プロパティとみなされます。
					スーパークラスとサブクラスでインスタンスフィールドの名前が重複しないように定義してください。
				</p>
<p>
					エンティティは
					<code>@MappedSuperclass</code>
					が指定されていないクラスも継承できます。
					しかし、この場合、スーパークラスのプロパティはサブクラスの永続プロパティとみなされません。
				</p>
<p>
					エンティティが他のエンティティを継承することはサポートされていません。
				</p>
</div>
</div>
<div class="section"><h2><a name="プロパティ定義"></a>
プロパティ定義</h2>
<div class="section"><h3><a name="永続プロパティの型"></a>
永続プロパティの型</h3>
<p><a href="#関連定義">関連</a>

					および
					<a href="#永続化対象外定義">永続化対象外</a>

					を除いたプロパティとして利用可能な型は次のとおりです。
				</p>
<dl><dt>プリミティブ型</dt>
<dd><ul><li>boolean</li>
<li>char</li>
<li>byte</li>
<li>short</li>
<li>int</li>
<li>long</li>
<li>float</li>
<li>double</li>
</ul>
</dd>
<dt>ラッパー型</dt>
<dd><ul><li>Boolean</li>
<li>Character</li>
<li>Byte</li>
<li>Short</li>
<li>Integer</li>
<li>Long</li>
<li>Float</li>
<li>Double</li>
</ul>
</dd>
<dt>文字列型</dt>
<dd><ul><li>java.lang.String</li>
</ul>
<p>
							※
							<a href="#ラージオブジェクト定義">ラージオブジェクト</a>

							にすることができます。
						</p>
</dd>
<dt>数値型</dt>
<dd><ul><li>java.math.BigDecimal</li>
<li>java.math.BigInteger</li>
</ul>
</dd>
<dt>日付・時刻型</dt>
<dd><ul><li>java.util.Date</li>
<li>java.util.Calendar</li>
<li>java.sql.Date</li>
<li>java.sql.Time</li>
<li>java.sql.Timestamp</li>
</ul>
<p>
							※
							<code>java.util.Date</code>
							および
							<code>java.util.Calendar</code>
							型のプロパティには
							<a href="#時制定義">時制</a>

							の指定が必須です．
						</p>
</dd>
<dt>バイト列型</dt>
<dd><ul><li>byte[]</li>
</ul>
<p>
							※
							<a href="#ラージオブジェクト定義">ラージオブジェクト</a>

							にすることができます。
						</p>
</dd>
<dt>シリアライズ可能型</dt>
<dd><ul><li>java.io.Serializable</li>
</ul>
<p>
							※
							<a href="#ラージオブジェクト定義">ラージオブジェクト</a>

							にすることができます。
						</p>
</dd>
</dl>
</div>
<div class="section"><h3><a name="カラム定義"></a>
カラム定義</h3>
<p>
					カラム情報を指定するには、
					<code>@Column</code>
					を使います。
				</p>
<p>
					name属性でカラム名を指定することができます。
					指定しなかった場合、カラム名はフィールド名と同じになります。フィールド名が、
					<code>aaaBbb</code>
					のようなキャメル記法の場合、カラム名は、
					<code>AAA_BBB</code>
					のように'_'区切りだとみなされます。
				</p>
<p>
					このルールは、convention.diconで指定されている
					<code>
						org.seasar.framework.convention.impl.PersistenceNamingConventionImpl
					</code>
					のfromPropertyNameToColumnName()の実装を変えることで、カスタマイズすることができます。
				</p>
<p>
					デフォルトでは、プロパティ名とフィールド名は同じになりますが、convention.diconで指定されている
					<code>
						org.seasar.framework.convention.impl.PersistenceNamingConventionImpl
					</code>
					のfromFieldNameToPropertyName()の実装を変えることで、カスタマイズすることができます。
				</p>
<p>次の例では、AB1234というカラム名を指定しています。</p>
<div class="source"><pre>
@Column(name = &quot;AB1234&quot;)
public String shortName;
</pre>
</div>
<p>
					insertable属性で挿入可能かどうかを指定することができます。デフォルトはtrueです。
					falseの場合、挿入用のSQLにこのカラムは含まれません。
					カラムにデフォルト値を適用したい場合は、falseにすると良いでしょう。
				</p>
<p>
					updatable属性で更新可能かどうかを指定することができます。デフォルトはtrueです。
					falseの場合、更新用のSQLにこのカラムは含まれません。
					カラムにデフォルト値を適用したい場合は、falseにすると良いでしょう。
				</p>
</div>
<div class="section"><h3><a name="識別子定義"></a>
識別子定義</h3>
<p>
					識別子(主キー)であることを指定するには、
					<code>@Id</code>
					を使います。
				</p>
<div class="source"><pre>
@Id
public Integer id;
</pre>
</div>
<p>
					複合主キーの場合は、
					<code>@Id</code>
					を複数つけます。
				</p>
<div class="source"><pre>
@Id
public Integer id;

@Id
public Integer id2;
</pre>
</div>
<p>
					識別子は、アプリケーション側で生成することもできますが、
					Seasar2に自動生成させることもできます。自動生成させるには、
					<code>@GeneratedValue</code>
					を使います。
				</p>
<p>
					自動生成のタイプは、
					<code>@GeneratedValue</code>
					の
					<code>strategy</code>
					属性で指定します。指定できるタイプのは次の4つです。
				</p>
<dl><dt>GenerationType.TABLE</dt>
<dd>テーブルを使います。</dd>
<dt>GenerationType.SEQUENCE</dt>
<dd>シーケンスを使います。</dd>
<dt>GenerationType.IDENTITY</dt>
<dd>データベース固有の識別子自動生成を使います。</dd>
<dt>GenerationType.AUTO(デフォルト)</dt>
<dd>
						データベースに応じてTABLE・SEQUENCE・IDENTITYのどちらかが選択されます。
						IDENTITYが使える場合はIDENTITYに、
						IDENTITYが使えなくてSEQUENCEが使える場合はSEQUENCEに、
						IDENTITYもSEQUENCEも使えない場合はTABLEになります。
					</dd>
</dl>
<h4>GenerationType.TABLE</h4>
<p>GenerationType.TABLEは次のようにして使います。</p>
<div class="source"><pre>
@Id
@GeneratedValue(strategy = GenerationType.TABLE)
public Integer id;
</pre>
</div>
<p>上記のように指定した場合、あらかじめ、次のようなテーブルとデータを用意しておく必要があります。</p>
<div class="source"><pre>
create table ID_GENERATOR {
  PK varchar(80) not null primary key,
  VALUE integer);
</pre>
</div>
<div class="source"><pre>
insert into ID_GENERATOR (PK, VALUE) values ('EMPLOYEE_ID', 1);
</pre>
</div>
<p>
					ID_GENERATORテーブルのPKカラムには、&lt;テーブル名&gt;_&lt;識別子のカラム名&gt;を設定します。
				</p>
<p>
					テーブル名やカラム名をカスタマイズするには、次のように@TableGeneratorアノテーションで指定します。
				</p>
<div class="source"><pre>
@Id
@GeneratedValue(strategy = GenerationType.TABLE, generator = &quot;EMPLOYEE_GEN&quot;)
@TableGenerator(
    name = &quot;EMPLOYEE_GEN&quot;,
    table = &quot;ID_GEN&quot;,
    pkColumnName = &quot;GEN_NAME&quot;,
    valueColumnName = &quot;GEN_VALUE&quot;)
public Integer id;
</pre>
</div>
<p>
					上記のようなTableGeneratorを定義した場合、
					あらかじめ、次のようなテーブルとデータを用意しておく必要があります。
				</p>
<div class="source"><pre>
create table ID_GEN {
  GEN_NAME varchar(80) not null primary key,
  GEN_VALUE integer);
</pre>
</div>
<div class="source"><pre>
insert into ID_GEN (GEN_NAME, GEN_VALUE) values ('EMPLOYEE_GEN', 1);
</pre>
</div>
<h4>GenerationType.SEQUENCE</h4>
<p>GenerationType.SEQUENCEは次のようにして使います。</p>
<div class="source"><pre>
@Id
@GeneratedValue(strategy = GenerationType.SEQUENCE)
public Integer id;
</pre>
</div>
<p>上記のように指定した場合、あらかじめ、次のようなシーケンスを用意しておく必要があります。</p>
<div class="source"><pre>
create sequence EMPLOYEE_ID
  incremet by 50;
</pre>
</div>
<p>シーケンス名は、&lt;テーブル名&gt;_&lt;識別子のカラム名&gt;となります。</p>
<p>
					シーケンス名をカスタマイズするには、次のように@SequenceGeneratorアノテーションで指定します。
				</p>
<div class="source"><pre>
@Id
@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = &quot;EMPLOYEE_GEN&quot;)
@SequenceGenerator(
    name = &quot;EMPLOYEE_GEN&quot;,
    sequenceName = &quot;EMPLOYEE_SEQ&quot;)
public Integer id;
</pre>
</div>
<p>
					上記のようなSequenceGeneratorを定義した場合、
					あらかじめ、次のようなシーケンスを用意しておく必要があります。
				</p>
<div class="source"><pre>
create sequence EMPLOYEE_SEQ
  incremet by 50;
</pre>
</div>
<h4>GenerationType.IDENTITY</h4>
<p>GenerationType.IDENTITYは次のようにして使います。</p>
<div class="source"><pre>
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
public Integer id;
</pre>
</div>
<p>
					GenerationType.IDENTITYを使う場合、
					識別子はデータベース固有の方法を使って自動生成されるようにしてください。
				</p>
<div class="source"><pre>
create table Employee {
  ID integer not null primary key generated always as identity,
  ...);
</pre>
</div>
</div>
<div class="section"><h3><a name="バージョン定義"></a>
バージョン定義</h3>
<p>
					バージョンチェック用であることを指定するには、
					<code>@Version</code>
					を使います。更新時に、エンティティの値とカラムの値が同一かどうかをチェックし、
					同一ならカラムの値がインクリメントされて更新されます。同一でない場合、
					<code>
						javax.persistence.OptimisticLockException
					</code>
					が発生します。
				</p>
<p>
					例えば、エンティティのバージョンチェック用のプロパティの値が1だったとします。
					更新時にカラムの値が1のままならOKで、2に更新されます。
					カラムの値が1でない場合は、他で更新されているということなので、
					<code>
						javax.persistence.OptimisticLockException
					</code>
					が発生します。
				</p>
<div class="source"><pre>
@Version
public Long version = 0L;
</pre>
</div>
<div style="background-color: red; font-weight: bold; font-size: larger;"><p>注意点</p>
</div><p>
					@Versionアノテーションは数値型のフィールドにのみ指定することができます。JPA仕様ではTimestamp型のフィールドもバージョンチェックに使用できることになっていますが、S2JDBCではサポートしていません。更新時刻の保持と排他制御は目的が違うので別のフィールドにしてください。
				</p>
</div>
<div class="section"><h3><a name="時制定義"></a>
時制定義</h3>
<p><code>java.util.Date</code>
					および
					<code>java.util.Calendar</code>
					型のプロパティには時制を指定します。 時制を指定するには、
					<code>@Temporal</code>
					を使います。
					<code>@Temporal</code>
					で指定可能な値は次のとおりです。
				</p>
<dl><dt><code>TemporalType.DATE</code></dt>
<dd>
						SQL標準の
						<code>DATE</code>
						型 (日付のみ) として扱うことを指定します。
					</dd>
<dt><code>TemporalType.TIME</code></dt>
<dd>
						SQL標準の
						<code>TIME</code>
						型 (時刻のみ) として扱うことを指定します。
					</dd>
<dt><code>TemporalType.TIMESTAMP</code></dt>
<dd>
						SQL標準の
						<code>TIMESTAMP</code>
						型 (日付と時刻) として扱うことを指定します。
					</dd>
</dl>
<div class="source"><pre>
@Temporal(TemporalType.DATE)
public Date date;
</pre>
</div>
</div>
<div class="section"><h3><a name="ラージオブジェクト定義"></a>
ラージオブジェクト定義</h3>
<p><code>byte[]</code>
					・
					<code>Serializable</code>
					・
					<code>String</code>
					型のプロパティはラージオブジェクトにすることができます。 ラージオブジェクトであることを指定するには、
					<code>@Lob</code>
					を使います。
				</p>
<p><code>@Lob</code>
					が指定されたプロパティが
					<code>byte[]</code>
					・
					<code>Serializable</code>
					型ならBLOB、
					<code>String</code>
					型ならCLOBとなります。
				</p>
<div class="source"><pre>
@Lob
public String largeName;

@Lob
public byte[] largeArray;

@Lob
public LargeDto largeDto;
</pre>
</div>
</div>
<div class="section"><h3><a name="永続化対象外定義"></a>
永続化対象外定義</h3>
<p>
					永続化対象外であることを指定するには、
					<code>@Transient</code>
					を使います。
					<code>transient</code>
					修飾子も指定することもできますが、セッションリプリケーションなどの直列化の対象から外れてしまうので、
					<code>@Transient</code>
					の方をお勧めします。
				</p>
<div class="source"><pre>
@Transient
public MyDto myDto;

//こちらはお勧めしない
public transient MyDto myDto2;
</pre>
</div>
</div>
</div>
<div class="section"><h2><a name="関連定義"></a>
関連定義</h2>
<div class="section"><h3><a name="多対一関連定義"></a>
多対一関連定義</h3>
<p>
					多対一関連であることを指定するには、
					<code>@ManyToOne</code>
					を使います。複数のEmployeeに1つのDepartementが関連付けられる場合、
					EmployeeからみてDepartmentは多対一関連になります。
					関連には、所有者、非所有者という概念があり、外部キーを持っているほうが所有者になります。
				</p>
<p>
					上記のケースは、Employeeのテーブルに、
					department_id(プロパティ名はdepartmentId)という外部キーがあるので、
					Employeeは関連の所有者になります。
				</p>
<p><code>@ManyToOne</code>
					を定義するエンティティは、必ず関連の所有者になるので、外部キーに対応するプロパティが必要です。
				</p>
<div class="source"><pre>
public class Employee {
    ...
    public Integer departementId;
    
    @ManyToOne
    public Department department;
}
</pre>
</div>
</div>
<div class="section"><h3><a name="一対多関連定義"></a>
一対多関連定義</h3>
<p>
					一対多関連であることを指定するには、
					<code>@OneToMany</code>
					を使います。1つのDepartmentに複数のEmployeeが関連付けられる場合、
					DepartmentからみてEmployeeは一対多関連になります。
					関連には、所有者、非所有者という概念があり、外部キーを持っているほうが所有者になります。
				</p>
<p>
					上記のケースは、Employeeのテーブルに、
					department_id(プロパティ名はdepartmentId)という外部キーがあり、
					Departmentの方は、外部キーを持っていないので、
					Departmentは関連の非所有者になります。
				</p>
<p>
					関連の非所有者の場合、必ずmappedBy属性で逆側の関連のプロパティ名を指定します。
					Departmentからみて一対多でEmployeeが関連付けられていて、
					そのEmployeeからみるとDepartmentがdepartmentプロパティとして、
					多対一で関連付けられています。お互いが相互の関連であることを示すために
					<code>mappedBy</code>
					でdepartmentを指定します。
				</p>
<p>
					一対多の関連の型は、
					<code>List&lt;エンティティ型&gt;</code>
					にします。
					どのエンティティのリストなのかを示すためにGenericsの指定を忘れないようにしてください。
				</p>
<div class="source"><pre>
public class Department {
    ...
    @OneToMany(mappedBy = &quot;department&quot;)
    public List&lt;Employee&gt; employeeList;
}
</pre>
</div>
</div>
<div class="section"><h3><a name="一対一関連定義"></a>
一対一関連定義</h3>
<p>
					一対一関連であることを指定するには、
					<code>@OneToOne</code>
					を使います。1つのEmployeeに1つのAddressが関連付けられる場合、
					EmployeeからみてAddressは一対一関連になります。
					同じように、1つのAddressに1つのEmployeeが関連付けられているので、
					AddressからみてEmployeeも一対一関連になります。
					関連には、所有者、非所有者という概念があり、外部キーを持っているほうが所有者になります。
				</p>
<p>
					上記のケースは、Employeeのテーブルに、
					address_id(プロパティ名はaddressId)という外部キーがあるので、
					Employeeは関連の所有者になります。Addressの方は、外部キーを持っていないので、
					Addressは関連の非所有者になります。
				</p>
<p>
					関連の非所有者の場合、必ずmappedBy属性で逆側の関連のプロパティ名を指定します。
					Addressから見ると一対一でEmployeeが関連付けられていて、
					そのEmployeeからみるとAddressがaddressプロパティとして、
					一対一で関連付けられています。お互いが相互の関連であることを示すために
					<code>mappedBy</code>
					でaddressを指定します。
				</p>
<div class="source"><pre>
public class Employee {
    ...
    public Integer addressId;
    
    @OneToOne
    public Address address;
}
</pre>
</div>
<div class="source"><pre>
public class Address {
    ...
    @OneToOne(mappedBy = &quot;address&quot;)
    public Employee employee;
}
</pre>
</div>
</div>
<div class="section"><h3><a name="結合カラム定義"></a>
結合カラム定義</h3>
<p>
					外部キーを持っている方を関連の所有者といいますが、関連の所有者側では、
					<code>@JoinColumn</code>
					を使って、結合用のカラムを指定することができます。
				</p>
<p>
					name属性で、外部キーを指定します。
					name属性を省略した場合、「関連のプロパティ名_関連テーブルの主キー」が 自動的に設定されます。
					主キーは、プロパティ名ではなく、カラム名なので注意してください。
				</p>
<div class="source"><pre>
public class Employee {
    ...
    public Integer departementId;
    
    @ManyToOne
    public Department department;
}
</pre>
</div>
<p>
					上記の例では、
					<code>@JoinColumn</code>
					が省略されているので、
					name属性は、「関連のプロパティ名(department)_関連テーブルの主キー(ID)」、
					つまりDEPARTMENT_IDになります。
				</p>
<p>
					departmentがDEPARTMENTに変換されているのは、
					プロパティ名をカラム名に変換するときに、
					キャメル記法は、'_'区切りになり、'_'以外は大文字に変換されるというルールがあるからです。
				</p>
<p>
					このルールは、convention.diconで指定されている
					<code>
						org.seasar.framework.convention.impl.PersistenceNamingConventionImpl
					</code>
					の
					fromPropertyNameToColumnName()の実装を変えることで、カスタマイズすることができます。
				</p>
<p>
					referencedColumnName属性で、関連テーブルの主キーを指定します。
					referencedColumnName属性を省略した場合、
					「関連テーブルの主キー」が自動的に設定されます。
					主キーは、プロパティ名ではなく、カラム名なので注意してください。
				</p>
<div class="source"><pre>
public class Employee {
    ...
    public Integer departementId;
    
    @ManyToOne
    public Department department;
}
</pre>
</div>
<p>
					上記の例では、
					<code>@JoinColumn</code>
					が省略されているので、
					referencedColumnName属性は、「関連テーブルの主キー(ID)」、
					つまりIDになります。
				</p>
</div>
</div>

</div><!-- article -->

</div><!-- contents_center -->

<div id="footer">
<address>  &copy; Copyright
  
          2004-2008,
    
          The Seasar Foundation and the others. All rights reserved.
      </address>
<div class="line"><span class="hide">spacer</span></div>
</div><!-- footer -->

</div><!-- wrapper -->

</body>
</html>
